<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éŸ³æ¨‚é‡é€£æ¸¬è©¦ - VibeLo</title>
    <style>
        body {
            font-family: 'Microsoft JhengHei', Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 30px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        h1 {
            text-align: center;
            margin-bottom: 30px;
            color: #fff;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .section {
            margin-bottom: 25px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .section h3 {
            margin-top: 0;
            color: #ffd700;
            border-bottom: 2px solid #ffd700;
            padding-bottom: 10px;
        }
        
        .feature-list {
            list-style: none;
            padding: 0;
        }
        
        .feature-list li {
            padding: 8px 0;
            padding-left: 25px;
            position: relative;
        }
        
        .feature-list li:before {
            content: "âœ…";
            position: absolute;
            left: 0;
            color: #4CAF50;
        }
        
        .test-button {
            display: block;
            width: 100%;
            padding: 15px;
            margin: 15px 0;
            background: linear-gradient(45deg, #FF6B6B, #4ECDC4);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .test-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .note {
            background: rgba(255, 193, 7, 0.2);
            border: 1px solid rgba(255, 193, 7, 0.5);
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            color: #fff;
            font-size: 14px;
        }
        
        .status {
            background: rgba(76, 175, 80, 0.2);
            border: 1px solid rgba(76, 175, 80, 0.5);
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            color: #4CAF50;
            font-weight: bold;
        }
        
        .log-area {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸµ éŸ³æ¨‚é‡é€£åŠŸèƒ½æ¸¬è©¦</h1>
        
        <div class="note" style="margin-bottom: 20px; text-align: center;">
            <strong>ğŸ“ ä½¿ç”¨èªªæ˜ï¼š</strong><br>
            é€™å€‹æ¸¬è©¦é é¢æœƒè¼‰å…¥ music-stream-fix.js ä¸¦æ¨¡æ“¬ WebSocket ç’°å¢ƒ<br>
            æ‚¨å¯ä»¥æ¸¬è©¦éŸ³æ¨‚é‡é€£ã€åˆ†é éŸ³è¨Šç‹€æ…‹åŒæ­¥ç­‰åŠŸèƒ½<br>
            æ‰€æœ‰æ¸¬è©¦éƒ½åœ¨ç€è¦½å™¨æœ¬åœ°åŸ·è¡Œï¼Œç„¡éœ€çœŸå¯¦çš„ç›´æ’­ç’°å¢ƒ
        </div>
        
        <div class="section">
            <h3>ğŸ”§ ä¿®å¾©å…§å®¹</h3>
            <ul class="feature-list">
                <li>éŸ³æ¨‚æµç‹€æ…‹åŒæ­¥ - è§€çœ¾é‡æ•´å¾Œèƒ½è‡ªå‹•æª¢æ¸¬éŸ³æ¨‚ç‹€æ…‹</li>
                <li>åˆ†é éŸ³è¨Šç‹€æ…‹åŒæ­¥ - èƒŒæ™¯éŸ³æ¨‚åˆ†äº«ç‹€æ…‹çš„å®Œæ•´è¿½è¹¤</li>
                <li>è‡ªå‹•é‡é€£æ©Ÿåˆ¶ - WebRTC éŸ³è¨Šè»Œé“è‡ªå‹•é‡æ–°å»ºç«‹</li>
                <li>ç‹€æ…‹å„²å­˜æ¢å¾© - ä½¿ç”¨ localStorage æš«å­˜éŸ³è¨Šç‹€æ…‹</li>
                <li>å³æ™‚ç‹€æ…‹å»£æ’­ - éŸ³æ¨‚/åˆ†é éŸ³è¨Šç‹€æ…‹å³æ™‚é€šçŸ¥è§€çœ¾</li>
                <li>å®šæœŸæª¢æŸ¥æ©Ÿåˆ¶ - æ¯30ç§’æª¢æŸ¥æ‰€æœ‰éŸ³è¨Šç‹€æ…‹</li>
            </ul>
        </div>
        
        <div class="section">
            <h3>ğŸ§ª æ¸¬è©¦æ­¥é©Ÿ</h3>
            <div class="note">
                <strong>ğŸ“‹ æ¸¬è©¦æµç¨‹ï¼š</strong><br>
                1. ä¸»æ’­é–‹å•ŸéŸ³æ¨‚ä¸¦é–‹å§‹ç›´æ’­<br>
                2. è§€çœ¾è§€çœ‹ç›´æ’­ä¸¦è½åˆ°éŸ³æ¨‚<br>
                3. è§€çœ¾é‡æ–°æ•´ç†é é¢ï¼ˆF5 æˆ– Ctrl+Rï¼‰<br>
                4. ç¢ºèªéŸ³æ¨‚è‡ªå‹•é‡æ–°é€£æ¥ä¸¦æ’­æ”¾<br>
                5. æª¢æŸ¥æ§åˆ¶å°æ—¥èªŒç¢ºèªé‡é€£éç¨‹
            </div>
            
            <button class="test-button" onclick="testMusicDetection()">
                ğŸ” æ¸¬è©¦éŸ³æ¨‚æª¢æ¸¬åŠŸèƒ½
            </button>
            
            <button class="test-button" onclick="testPageReload()">
                ğŸ”„ æ¨¡æ“¬é é¢é‡æ•´æ¸¬è©¦
            </button>
            
            <button class="test-button" onclick="testTabAudioStatus()">
                ğŸµ æ¸¬è©¦åˆ†é éŸ³è¨Šç‹€æ…‹
            </button>
            
            <button class="test-button" onclick="simulatePageRefresh()">
                ğŸ”„ å®Œæ•´æ¨¡æ“¬é é¢é‡æ•´
            </button>
            
            <button class="test-button" onclick="showDebugInfo()">
                ğŸ› é¡¯ç¤ºèª¿è©¦è³‡è¨Š
            </button>
        </div>
        
        <div class="section">
            <h3>ğŸ“Š ç•¶å‰ç‹€æ…‹</h3>
            <div id="currentStatus" class="status">
                ç­‰å¾…æª¢æ¸¬éŸ³æ¨‚ç‹€æ…‹...
            </div>
            
            <div class="log-area" id="logArea">
                éŸ³æ¨‚é‡é€£æ¸¬è©¦æ§åˆ¶å°æº–å‚™å°±ç·’...
            </div>
        </div>
        
        <div class="section">
            <h3>ğŸ“ æŠ€è¡“èªªæ˜</h3>
            <div class="note">
                <strong>ğŸµ éŸ³æ¨‚é‡é€£æ©Ÿåˆ¶ï¼š</strong><br>
                â€¢ ä½¿ç”¨ WebSocket å³æ™‚åŒæ­¥éŸ³æ¨‚æ’­æ”¾ç‹€æ…‹<br>
                â€¢ è§€çœ¾ç«¯é€é music-stream-fix.js å¯¦ç¾è‡ªå‹•é‡é€£<br>
                â€¢ ä¸»æ’­ç«¯é€é music-player.js ç™¼é€ç‹€æ…‹æ›´æ–°<br>
                â€¢ æœå‹™å™¨ç«¯å»£æ’­éŸ³æ¨‚ç‹€æ…‹çµ¦æ‰€æœ‰è§€çœ¾<br>
                â€¢ æ”¯æ´éŸ³é‡ã€éœéŸ³ç‹€æ…‹çš„å®Œæ•´åŒæ­¥
            </div>
        </div>
    </div>

    <!-- è¼‰å…¥éŸ³æ¨‚é‡é€£ä¿®å¾©è…³æœ¬ -->
    <script src="music-stream-fix.js"></script>

    <script>
        // éŸ³æ¨‚é‡é€£æ¸¬è©¦è…³æœ¬
        let logArea = document.getElementById('logArea');
        let statusDiv = document.getElementById('currentStatus');
        
        function log(message) {
            const time = new Date().toLocaleTimeString();
            const logEntry = `[${time}] ${message}\n`;
            logArea.textContent += logEntry;
            logArea.scrollTop = logArea.scrollHeight;
            console.log(`[éŸ³æ¨‚é‡é€£æ¸¬è©¦] ${message}`);
        }
        
        function updateStatus(message, isSuccess = true) {
            statusDiv.innerHTML = message;
            statusDiv.style.borderColor = isSuccess ? 'rgba(76, 175, 80, 0.5)' : 'rgba(244, 67, 54, 0.5)';
            statusDiv.style.backgroundColor = isSuccess ? 'rgba(76, 175, 80, 0.2)' : 'rgba(244, 67, 54, 0.2)';
            statusDiv.style.color = isSuccess ? '#4CAF50' : '#F44336';
        }
        
        function testMusicDetection() {
            log('ğŸ” é–‹å§‹æ¸¬è©¦éŸ³æ¨‚æª¢æ¸¬åŠŸèƒ½...');
            updateStatus('ğŸ” æ­£åœ¨æª¢æ¸¬éŸ³æ¨‚é‡é€£åŠŸèƒ½...');
            
            if (typeof window.musicStreamReconnectManager !== 'undefined') {
                log('âœ… éŸ³æ¨‚é‡é€£ç®¡ç†å™¨å·²è¼‰å…¥');
                updateStatus('âœ… éŸ³æ¨‚é‡é€£åŠŸèƒ½å·²å•Ÿç”¨ï¼Œæª¢æ¸¬åˆ°éŸ³æ¨‚æœƒè‡ªå‹•é‡é€£', true);
                
                // æª¢æŸ¥ WebSocket é€£æ¥
                if (window.socket && window.socket.readyState === WebSocket.OPEN) {
                    log('âœ… WebSocket é€£æ¥æ­£å¸¸');
                    
                    // è«‹æ±‚éŸ³æ¨‚ç‹€æ…‹
                    window.musicStreamReconnectManager.requestMusicStreamState();
                    log('ğŸ“¡ å·²ç™¼é€éŸ³æ¨‚ç‹€æ…‹æŸ¥è©¢è«‹æ±‚');
                } else {
                    log('âš ï¸ WebSocket æœªé€£æ¥');
                    updateStatus('âš ï¸ éœ€è¦å…ˆé€£æ¥åˆ°ç›´æ’­æœå‹™å™¨', false);
                }
            } else {
                log('âŒ éŸ³æ¨‚é‡é€£ç®¡ç†å™¨æœªè¼‰å…¥');
                updateStatus('âŒ éŸ³æ¨‚é‡é€£åŠŸèƒ½æœªå•Ÿç”¨', false);
            }
        }
        
        function testPageReload() {
            log('ğŸ”„ æ¨¡æ“¬é é¢é‡æ•´æ¸¬è©¦...');
            updateStatus('ğŸ”„ æº–å‚™é‡æ–°æ•´ç†é é¢...', false);
            
            // æ¨¡æ“¬ä¿å­˜éŸ³æ¨‚ç‹€æ…‹
            if (typeof window.musicStreamReconnectManager !== 'undefined') {
                const mockMusicState = {
                    isPlaying: true,
                    currentVideoId: 'dQw4w9WgXcQ',
                    volume: 80,
                    isMuted: false
                };
                
                localStorage.setItem('musicStreamState', JSON.stringify(mockMusicState));
                log('ğŸ’¾ å·²å„²å­˜æ¨¡æ“¬éŸ³æ¨‚ç‹€æ…‹åˆ° localStorage');
                
                setTimeout(() => {
                    log('ğŸ”„ æ¨¡æ“¬é‡æ–°æ•´ç†å®Œæˆï¼Œæ‡‰è©²æœƒè‡ªå‹•æ¢å¾©éŸ³æ¨‚ç‹€æ…‹');
                    updateStatus('âœ… é é¢é‡æ•´å®Œæˆï¼Œæª¢æŸ¥éŸ³æ¨‚æ˜¯å¦è‡ªå‹•é‡é€£', true);
                }, 1000);
            } else {
                log('âŒ éŸ³æ¨‚é‡é€£ç®¡ç†å™¨æœªè¼‰å…¥');
                updateStatus('âŒ ç„¡æ³•åŸ·è¡Œé‡æ•´æ¸¬è©¦', false);
            }
        }
        
        function testTabAudioStatus() {
            log('ğŸµ é–‹å§‹æ¸¬è©¦åˆ†é éŸ³è¨Šç‹€æ…‹...');
            updateStatus('ğŸµ æ­£åœ¨æ¸¬è©¦åˆ†é éŸ³è¨Šç‹€æ…‹...');
            
            if (typeof window.tabAudioReconnectManager !== 'undefined') {
                log('âœ… åˆ†é éŸ³è¨Šé‡é€£ç®¡ç†å™¨å·²è¼‰å…¥');
                
                // è«‹æ±‚åˆ†é éŸ³è¨Šç‹€æ…‹
                if (window.tabAudioReconnectManager.requestTabAudioState) {
                    window.tabAudioReconnectManager.requestTabAudioState();
                    log('ğŸ“¡ å·²ç™¼é€åˆ†é éŸ³è¨Šç‹€æ…‹æŸ¥è©¢è«‹æ±‚');
                    updateStatus('âœ… åˆ†é éŸ³è¨Šç‹€æ…‹æ¸¬è©¦å·²å•Ÿå‹•', true);
                } else {
                    log('âš ï¸ åˆ†é éŸ³è¨Šç‹€æ…‹è«‹æ±‚æ–¹æ³•æœªæ‰¾åˆ°');
                    updateStatus('âš ï¸ åˆ†é éŸ³è¨ŠåŠŸèƒ½ä¸å¯ç”¨', false);
                }
            } else {
                log('âŒ åˆ†é éŸ³è¨Šé‡é€£ç®¡ç†å™¨æœªè¼‰å…¥');
                updateStatus('âŒ åˆ†é éŸ³è¨Šé‡é€£åŠŸèƒ½æœªå•Ÿç”¨', false);
            }
        }
        
        function simulatePageRefresh() {
            log('ğŸ”„ é–‹å§‹å®Œæ•´æ¨¡æ“¬é é¢é‡æ•´æµç¨‹...');
            updateStatus('ğŸ”„ æ¨¡æ“¬é é¢é‡æ•´æµç¨‹ä¸­...', false);
            
            // æ­¥é©Ÿ1ï¼šä¿å­˜ç•¶å‰ç‹€æ…‹åˆ° localStorage
            const mockMusicState = {
                isPlaying: true,
                currentVideoId: 'dQw4w9WgXcQ',
                volume: 85,
                isMuted: false
            };
            
            const mockTabAudioState = {
                enabled: true,
                audioType: 'tab',
                broadcasterId: window.myBroadcasterId
            };
            
            localStorage.setItem('musicStreamState', JSON.stringify(mockMusicState));
            localStorage.setItem('tabAudioState', JSON.stringify(mockTabAudioState));
            
            log('ğŸ’¾ ç‹€æ…‹å·²ä¿å­˜åˆ° localStorage');
            
            // æ­¥é©Ÿ2ï¼šæ¨¡æ“¬é é¢å¸è¼‰
            log('ğŸ“„ æ¨¡æ“¬é é¢å¸è¼‰...');
            
            // æ­¥é©Ÿ3ï¼šæ¨¡æ“¬é é¢é‡æ–°è¼‰å…¥
            setTimeout(() => {
                log('ğŸ“„ æ¨¡æ“¬é é¢é‡æ–°è¼‰å…¥...');
                
                // æ­¥é©Ÿ4ï¼šæª¢æŸ¥ä¿å­˜çš„ç‹€æ…‹
                const savedMusicState = localStorage.getItem('musicStreamState');
                const savedTabAudioState = localStorage.getItem('tabAudioState');
                
                if (savedMusicState) {
                    log('âœ… æª¢æ¸¬åˆ°ä¿å­˜çš„éŸ³æ¨‚ç‹€æ…‹');
                    console.log('ä¿å­˜çš„éŸ³æ¨‚ç‹€æ…‹:', JSON.parse(savedMusicState));
                }
                
                if (savedTabAudioState) {
                    log('âœ… æª¢æ¸¬åˆ°ä¿å­˜çš„åˆ†é éŸ³è¨Šç‹€æ…‹');
                    console.log('ä¿å­˜çš„åˆ†é éŸ³è¨Šç‹€æ…‹:', JSON.parse(savedTabAudioState));
                }
                
                // æ­¥é©Ÿ5ï¼šæ¨¡æ“¬è‡ªå‹•é‡é€£
                setTimeout(() => {
                    if (window.musicStreamReconnectManager) {
                        log('ğŸµ è§¸ç™¼éŸ³æ¨‚ç‹€æ…‹è«‹æ±‚...');
                        window.musicStreamReconnectManager.requestMusicStreamState();
                        
                        log('ğŸµ è§¸ç™¼åˆ†é éŸ³è¨Šç‹€æ…‹è«‹æ±‚...');
                        window.musicStreamReconnectManager.requestTabAudioState();
                    }
                    
                    // æ­¥é©Ÿ6ï¼šæ¸…é™¤ä¿å­˜çš„ç‹€æ…‹ï¼ˆæ¨¡æ“¬é‡é€£æˆåŠŸå¾Œæ¸…ç†ï¼‰
                    setTimeout(() => {
                        localStorage.removeItem('musicStreamState');
                        localStorage.removeItem('tabAudioState');
                        log('ğŸ—‘ï¸ å·²æ¸…é™¤ä¿å­˜çš„ç‹€æ…‹ï¼ˆé‡é€£æˆåŠŸï¼‰');
                        
                        updateStatus('âœ… é é¢é‡æ•´é‡é€£æµç¨‹æ¨¡æ“¬å®Œæˆ', true);
                        log('ğŸ‰ é é¢é‡æ•´é‡é€£æ¸¬è©¦å®Œæˆï¼');
                    }, 500);
                }, 300);
            }, 200);
        }
        
        function showDebugInfo() {
            log('ğŸ› é¡¯ç¤ºèª¿è©¦è³‡è¨Š...');
            
            const debugInfo = {
                'éŸ³æ¨‚é‡é€£ç®¡ç†å™¨': typeof window.musicStreamReconnectManager !== 'undefined' ? 'å·²è¼‰å…¥' : 'æœªè¼‰å…¥',
                'åˆ†é éŸ³è¨Šé‡é€£ç®¡ç†å™¨': typeof window.tabAudioReconnectManager !== 'undefined' ? 'å·²è¼‰å…¥' : 'æœªè¼‰å…¥',
                'WebSocket ç‹€æ…‹': window.socket ? window.socket.readyState : 'æœªå»ºç«‹',
                'è§€çœ¾ID': window.viewerId || 'æœªè¨­å®š',
                'å…¨åŸŸéŸ³æ¨‚æ’­æ”¾å™¨': window.youtubePlayer ? 'å·²è¼‰å…¥' : 'æœªè¼‰å…¥',
                'localStorage éŸ³æ¨‚ç‹€æ…‹': localStorage.getItem('musicStreamState') || 'ç„¡',
                'ä¸»æ’­ID': window.myBroadcasterId || 'æœªè¨­å®š'
            };
            
            Object.entries(debugInfo).forEach(([key, value]) => {
                log(`${key}: ${value}`);
            });
            
            updateStatus('ğŸ› èª¿è©¦è³‡è¨Šå·²é¡¯ç¤ºï¼ŒæŸ¥çœ‹æ§åˆ¶å°æ—¥èªŒ', true);
        }
        
        // æ¨¡æ“¬ WebSocket é€£æ¥ï¼ˆç”¨æ–¼æ¸¬è©¦ï¼‰
        function initializeMockWebSocket() {
            // å‰µå»ºæ¨¡æ“¬ WebSocket ç‰©ä»¶
            const mockSocket = {
                readyState: WebSocket.OPEN,
                send: function(message) {
                    const data = JSON.parse(message);
                    log(`ğŸ“¤ æ¨¡æ“¬ç™¼é€: ${data.type}`);
                    
                    // æ¨¡æ“¬æœå‹™å™¨éŸ¿æ‡‰
                    setTimeout(() => {
                        simulateServerResponse(data);
                    }, 100);
                }
            };
            
            window.socket = mockSocket;
            window.viewerId = 'test_viewer_' + Math.random().toString(36).substr(2, 5);
            window.myBroadcasterId = 'test_broadcaster_' + Math.random().toString(36).substr(2, 5);
            
            log(`ğŸ”— æ¨¡æ“¬ WebSocket å·²å»ºç«‹ï¼Œè§€çœ¾ID: ${window.viewerId}`);
            log(`ğŸ”— æ¨¡æ“¬ä¸»æ’­ID: ${window.myBroadcasterId}`);
        }
        
        // æ¨¡æ“¬æœå‹™å™¨éŸ¿æ‡‰
        function simulateServerResponse(requestData) {
            switch(requestData.type) {
                case 'request_music_stream_state':
                    log('ğŸ“¡ æ¨¡æ“¬æ”¶åˆ°éŸ³æ¨‚ç‹€æ…‹éŸ¿æ‡‰');
                    if (window.musicStreamReconnectManager) {
                        window.musicStreamReconnectManager.handleMusicStreamState({
                            isPlaying: true,
                            currentVideoId: 'dQw4w9WgXcQ',
                            volume: 80,
                            isMuted: false,
                            broadcasterId: window.myBroadcasterId
                        });
                    }
                    break;
                case 'request_tab_audio_state':
                    log('ğŸ“¡ æ¨¡æ“¬æ”¶åˆ°åˆ†é éŸ³è¨Šç‹€æ…‹éŸ¿æ‡‰');
                    if (window.tabAudioReconnectManager) {
                        window.tabAudioReconnectManager.handleTabAudioState({
                            enabled: true,
                            audioType: 'tab',
                            broadcasterId: window.myBroadcasterId
                        });
                    }
                    break;
            }
        }

        // ç›£è½éŸ³æ¨‚ç‹€æ…‹è®Šæ›´
        document.addEventListener('DOMContentLoaded', function() {
            log('ğŸµ éŸ³æ¨‚é‡é€£æ¸¬è©¦é é¢å·²è¼‰å…¥');
            
            // åˆå§‹åŒ–æ¨¡æ“¬ç’°å¢ƒ
            setTimeout(() => {
                initializeMockWebSocket();
                
                // æª¢æŸ¥ç›¸é—œè…³æœ¬æ˜¯å¦å·²è¼‰å…¥
                if (typeof window.musicStreamReconnectManager !== 'undefined') {
                    log('âœ… music-stream-fix.js å·²æˆåŠŸè¼‰å…¥');
                    
                    // åˆå§‹åŒ–éŸ³æ¨‚é‡é€£ç®¡ç†å™¨
                    window.musicStreamReconnectManager.initialize(window.socket, window.viewerId);
                    log('âœ… éŸ³æ¨‚é‡é€£ç®¡ç†å™¨å·²åˆå§‹åŒ–');
                    
                    // åˆå§‹åŒ–åˆ†é éŸ³è¨Šé‡é€£ç®¡ç†å™¨ï¼ˆä½œç‚ºè§€çœ¾ç«¯ï¼‰
                    if (typeof window.tabAudioReconnectManager !== 'undefined') {
                        log('âœ… åˆ†é éŸ³è¨Šé‡é€£ç®¡ç†å™¨å·²è¼‰å…¥');
                        updateStatus('âœ… æ‰€æœ‰éŸ³æ¨‚é‡é€£åŠŸèƒ½å·²å°±ç·’', true);
                    } else {
                        updateStatus('âš ï¸ éƒ¨åˆ†åŠŸèƒ½è¼‰å…¥ä¸­...', false);
                    }
                } else {
                    log('âŒ music-stream-fix.js è¼‰å…¥å¤±æ•—');
                    updateStatus('âŒ éŸ³æ¨‚é‡é€£åŠŸèƒ½è¼‰å…¥å¤±æ•—', false);
                }
            }, 1000);
        });
        
        // éŒ¯èª¤è™•ç†
        window.addEventListener('error', function(e) {
            log(`âŒ éŒ¯èª¤: ${e.message}`);
        });
        
        // æ¨¡æ“¬éŸ³æ¨‚ç‹€æ…‹æ›´æ–°
        window.addEventListener('message', function(e) {
            if (e.data && e.data.type && e.data.type.startsWith('music_')) {
                log(`ğŸµ æ”¶åˆ°éŸ³æ¨‚ç‹€æ…‹æ›´æ–°: ${e.data.type}`);
            }
        });
    </script>
</body>
</html>
